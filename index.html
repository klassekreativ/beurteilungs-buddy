<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beurteilungsbeitrag-Assistent</title>
<style>
:root {
  --primary: #2c5282;
  --primary-light: #ebf4ff;
  --primary-dark: #1a365d;
  --accent: #3182ce;
  --accent-light: #bee3f8;
  --bg: #f7fafc;
  --card: #ffffff;
  --text: #2d3748;
  --text-light: #718096;
  --border: #e2e8f0;
  --success: #38a169;
  --success-light: #c6f6d5;
  --warning: #d69e2e;
  --warning-light: #fefcbf;
  --radius: 8px;
  --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.06);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  font-size: 16px;
}

.app-header {
  background: var(--primary);
  color: #fff;
  padding: 1rem 2rem;
  box-shadow: var(--shadow-md);
  position: sticky;
  top: 0;
  z-index: 100;
}

.app-header h1 {
  font-size: 1.25rem;
  font-weight: 600;
}

.app-header p {
  font-size: 0.85rem;
  opacity: 0.85;
  margin-top: 0.15rem;
}

/* Progress Bar */
.progress-bar {
  display: flex;
  align-items: center;
  gap: 0;
  padding: 1rem 2rem;
  background: var(--card);
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
}

.progress-step {
  display: flex;
  align-items: center;
  flex-shrink: 0;
  cursor: pointer;
}

.progress-step .step-circle {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--border);
  color: var(--text-light);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: 600;
  transition: all 0.3s;
  flex-shrink: 0;
}

.progress-step .step-label {
  font-size: 0.75rem;
  color: var(--text-light);
  margin-left: 0.4rem;
  white-space: nowrap;
  transition: color 0.3s;
}

.progress-step.active .step-circle {
  background: var(--accent);
  color: #fff;
}

.progress-step.active .step-label {
  color: var(--primary);
  font-weight: 600;
}

.progress-step.completed .step-circle {
  background: var(--success);
  color: #fff;
}

.progress-step.completed .step-label {
  color: var(--success);
}

.progress-line {
  width: 24px;
  height: 2px;
  background: var(--border);
  flex-shrink: 0;
  margin: 0 4px;
}

.progress-line.completed {
  background: var(--success);
}

/* Main Container */
.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 1.5rem;
}

/* Step Sections */
.step-section {
  display: none;
}

.step-section.active {
  display: block;
}

.step-title {
  font-size: 1.35rem;
  font-weight: 700;
  color: var(--primary-dark);
  margin-bottom: 0.25rem;
}

.step-subtitle {
  font-size: 0.9rem;
  color: var(--text-light);
  margin-bottom: 1.5rem;
}

/* Cards */
.card {
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 1.5rem;
  margin-bottom: 1.25rem;
}

.card-title {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.card-hint {
  font-size: 0.82rem;
  color: var(--text-light);
  margin-bottom: 1rem;
  line-height: 1.5;
}

/* Form Elements */
label.form-label {
  display: block;
  font-weight: 600;
  font-size: 0.9rem;
  margin-bottom: 0.35rem;
  color: var(--text);
}

input[type="text"], input[type="date"], select, textarea {
  width: 100%;
  padding: 0.6rem 0.75rem;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  font-size: 0.95rem;
  font-family: inherit;
  color: var(--text);
  background: #fff;
  transition: border-color 0.2s;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(49,130,206,0.15);
}

textarea {
  resize: vertical;
  min-height: 80px;
}

.form-group {
  margin-bottom: 1rem;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

@media (max-width: 600px) {
  .form-row { grid-template-columns: 1fr; }
}

/* Rating Options */
.rating-options {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.rating-option {
  display: flex;
  align-items: flex-start;
  padding: 0.75rem 1rem;
  border: 2px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s;
  gap: 0.75rem;
}

.rating-option:hover {
  border-color: var(--accent-light);
  background: var(--primary-light);
}

.rating-option.selected {
  border-color: var(--accent);
  background: var(--primary-light);
}

.rating-option input[type="radio"] {
  margin-top: 0.2rem;
  accent-color: var(--accent);
  flex-shrink: 0;
}

.rating-option .option-text {
  font-size: 0.9rem;
  line-height: 1.4;
}

.rating-option .option-label {
  font-weight: 600;
  display: block;
}

.rating-option .option-desc {
  font-size: 0.82rem;
  color: var(--text-light);
}

/* Overall Rating */
.overall-rating {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.5rem;
  margin-top: 0.5rem;
}

@media (max-width: 500px) {
  .overall-rating { grid-template-columns: 1fr; }
}

.overall-option {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 0.75rem;
  border: 2px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.85rem;
}

.overall-option:hover {
  border-color: var(--accent-light);
  background: var(--primary-light);
}

.overall-option.selected {
  border-color: var(--accent);
  background: var(--primary-light);
}

.overall-option input[type="radio"] {
  accent-color: var(--accent);
}

/* Buttons */
.btn-row {
  display: flex;
  justify-content: space-between;
  margin-top: 2rem;
  gap: 1rem;
}

.btn {
  padding: 0.65rem 1.5rem;
  border-radius: var(--radius);
  font-size: 0.95rem;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
  font-family: inherit;
}

.btn-primary {
  background: var(--accent);
  color: #fff;
}

.btn-primary:hover { background: var(--primary); }

.btn-secondary {
  background: var(--border);
  color: var(--text);
}

.btn-secondary:hover { background: #cbd5e0; }

.btn-success {
  background: var(--success);
  color: #fff;
}

.btn-success:hover { background: #2f855a; }

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Lerngruppen Table */
.lg-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.5rem;
  font-size: 0.9rem;
}

.lg-table th, .lg-table td {
  border: 1px solid var(--border);
  padding: 0.5rem;
  text-align: left;
}

.lg-table th {
  background: var(--primary-light);
  font-weight: 600;
  font-size: 0.82rem;
}

.lg-table input {
  border: none;
  padding: 0.3rem;
  font-size: 0.9rem;
  width: 100%;
}

.lg-table input:focus {
  outline: none;
  box-shadow: none;
}

.btn-sm {
  padding: 0.3rem 0.6rem;
  font-size: 0.8rem;
  border-radius: 4px;
}

.btn-danger {
  background: #fc8181;
  color: #742a2a;
}

.btn-danger:hover { background: #feb2b2; }

/* Result Section */
.result-block {
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin-bottom: 1.5rem;
  overflow: hidden;
}

.result-header {
  background: var(--primary-light);
  padding: 0.75rem 1rem;
  font-weight: 600;
  font-size: 0.95rem;
  color: var(--primary-dark);
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.result-body {
  padding: 1rem;
  font-size: 0.92rem;
  line-height: 1.7;
  white-space: pre-wrap;
}

.copy-btn {
  padding: 0.3rem 0.7rem;
  font-size: 0.78rem;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-family: inherit;
  font-weight: 600;
}

.copy-btn:hover { background: var(--primary); }

.copy-btn.copied {
  background: var(--success);
}

/* Export Buttons */
.export-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

/* Toast Notification */
.toast {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  background: var(--primary-dark);
  color: #fff;
  padding: 0.75rem 1.25rem;
  border-radius: var(--radius);
  font-size: 0.9rem;
  box-shadow: var(--shadow-md);
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.3s;
  z-index: 1000;
  pointer-events: none;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

/* Print */
@media print {
  .app-header, .progress-bar, .btn-row, .export-row, .copy-btn, .no-print { display: none !important; }
  .container { max-width: 100%; padding: 0; }
  .step-section { display: block !important; }
  .result-block { box-shadow: none; border: 1px solid #ccc; break-inside: avoid; }
}
</style>
</head>
<body>

<header class="app-header">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:0.5rem">
    <div>
      <h1>Beurteilungsbeitrag-Assistent</h1>
      <p>Strukturierte Erstellung gem. &sect; 16 (2) OVP NRW</p>
    </div>
    <div style="text-align:right;font-size:0.75rem;opacity:0.75;line-height:1.4">
      Autorin: Alicja Gulcz &middot; mit Claude Opus 4.6 (Februar 2026)
    </div>
  </div>
</header>

<div style="background:#e6f6e6;border-bottom:1px solid #b2d8b2;padding:0.6rem 2rem;font-size:0.82rem;color:#276749;display:flex;align-items:center;gap:0.5rem">
  <span style="font-size:1.1rem">&#x1f512;</span>
  <span>Alle Daten bleiben lokal auf Ihrem Ger&auml;t. Es werden keine Daten an Server &uuml;bertragen oder weiterverarbeitet.</span>
</div>

<nav class="progress-bar" id="progressBar"></nav>

<main class="container">
  <!-- Step 0: Metadaten -->
  <section class="step-section active" id="step0">
    <h2 class="step-title">Metadaten erfassen</h2>
    <p class="step-subtitle">Allgemeine Angaben zur Lehramtsanw&auml;rterin / zum Lehramtsanw&auml;rter und zum Beurteilungszeitraum.</p>

    <div class="card">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="metaGeschlecht">Geschlecht *</label>
          <select id="metaGeschlecht">
            <option value="">Bitte w&auml;hlen</option>
            <option value="w">weiblich (Frau)</option>
            <option value="m">m&auml;nnlich (Herr)</option>
            <option value="d">divers</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="metaNachname">Nachname der/des LAA *</label>
          <input type="text" id="metaNachname" placeholder="z.B. M&uuml;ller">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="metaVorname">Vorname (optional, f&uuml;r KI-Prompt)</label>
        <input type="text" id="metaVorname" placeholder="z.B. Max">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="metaLehramt">Lehramt *</label>
          <select id="metaLehramt">
            <option value="">Bitte w&auml;hlen</option>
            <option value="GyGe">Gymnasium/Gesamtschule (GyGe)</option>
            <option value="HRSGe">Haupt-/Real-/Sekundar-/Gesamtschule (HRSGe)</option>
            <option value="GS">Grundschule (GS)</option>
            <option value="BK">Berufskolleg (BK)</option>
            <option value="SP">Sonderpädagogische Förderung (SP)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="metaFach">Fach/F&auml;cher *</label>
          <input type="text" id="metaFach" placeholder="z.B. Deutsch, Mathematik">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="metaSchule">Ausbildungsschule *</label>
        <input type="text" id="metaSchule" placeholder="z.B. Gesamtschule Musterstadt">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="metaVon">Beurteilungszeitraum von *</label>
          <input type="date" id="metaVon">
        </div>
        <div class="form-group">
          <label class="form-label" for="metaBis">Beurteilungszeitraum bis *</label>
          <input type="date" id="metaBis">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="metaAbschnitt">Ausbildungsabschnitt *</label>
        <select id="metaAbschnitt">
          <option value="">Bitte w&auml;hlen</option>
          <option value="1">Erster Ausbildungsabschnitt</option>
          <option value="2">Zweiter Ausbildungsabschnitt</option>
          <option value="3">Weiterer Ausbildungsabschnitt</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label" for="metaBeurteiler">Name der/des Beurteilenden *</label>
        <input type="text" id="metaBeurteiler" placeholder="z.B. Anna Schmidt">
      </div>
    </div>

    <div class="card">
      <h3 class="card-title">Lerngruppen und Themenschwerpunkte</h3>
      <p class="card-hint">Tragen Sie die beobachteten Lerngruppen und deren Themenschwerpunkte ein.</p>
      <table class="lg-table" id="lgTable">
        <thead>
          <tr>
            <th style="width:25%">Zeitraum</th>
            <th style="width:20%">Klasse / Lerngruppe</th>
            <th>Themenschwerpunkte</th>
            <th style="width:40px"></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" class="lg-zeitraum" placeholder="z.B. 11/24 – 04/25"></td>
            <td><input type="text" class="lg-klasse" placeholder="z.B. 7b"></td>
            <td><input type="text" class="lg-thema" placeholder="z.B. Lyrik der Romantik"></td>
            <td></td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-secondary btn-sm" style="margin-top:0.5rem" onclick="addLerngruppe()">+ Lerngruppe hinzuf&uuml;gen</button>
    </div>

    <div class="btn-row">
      <span></span>
      <button class="btn btn-primary" onclick="goToStep(1)">Weiter &rarr;</button>
    </div>
  </section>

  <!-- Steps 1-5: Handlungsfelder (generated by JS) -->
  <section class="step-section" id="step1"></section>
  <section class="step-section" id="step2"></section>
  <section class="step-section" id="step3"></section>
  <section class="step-section" id="step4"></section>
  <section class="step-section" id="step5"></section>

  <!-- Step 6: Ergebnis -->
  <section class="step-section" id="step6">
    <h2 class="step-title">Ergebnis &amp; Export</h2>
    <p class="step-subtitle">Die generierten Textbausteine k&ouml;nnen direkt in das offizielle Formular &uuml;bernommen werden.</p>

    <div class="export-row no-print">
      <button class="btn btn-primary" onclick="copyAll()">Alle Texte kopieren</button>
      <button class="btn btn-success" onclick="copyKIPrompt(false)">KI-Prompt (mit Namen)</button>
      <button class="btn btn-success" style="background:#805ad5" onmouseover="this.style.background='#6b46c1'" onmouseout="this.style.background='#805ad5'" onclick="copyKIPrompt(true)">KI-Prompt (anonymisiert)</button>
      <button class="btn btn-secondary" onclick="window.print()">Druckansicht</button>
    </div>

    <div id="resultContainer"></div>

    <div class="btn-row no-print">
      <button class="btn btn-secondary" onclick="goToStep(5)">&larr; Zur&uuml;ck</button>
      <span></span>
    </div>
  </section>
</main>

<div class="toast" id="toast"></div>

<script>
// ============================================================
// DATA: Handlungsfelder, Fragen, Textbausteine
// ============================================================
const HF_DATA = [
  {
    id: 'U',
    title: 'HF U \u2013 Unterricht f\u00fcr heterogene Lerngruppen gestalten und Lernprozesse nachhaltig anlegen',
    shortTitle: 'HF U',
    label: 'Unterricht',
    kompetenzen: 'Kompetenzen 1\u20133: Unterrichtsplanung und -durchf\u00fchrung, Lernsituationen gestalten, selbstbestimmtes Lernen f\u00f6rdern',
    questions: [
      {
        id: 'u1',
        text: 'Wie plant und strukturiert die LAA den Unterricht?',
        hint: 'Erkennbar z.\u202fB. an: Stundenverlaufsplan, roter Faden, Passung von Zielen und Methoden, Ber\u00fccksichtigung der Lerngruppe, schl\u00fcssige Reihenplanung, fachliche Korrektheit.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Plant sachlich und fachlich in besonderem Ma\u00dfe fundiert. Stunden sind hervorragend strukturiert, Ziele, Inhalte und Methoden greifen nahtlos ineinander. Die Planung ber\u00fccksichtigt differenziert die Lernvoraussetzungen.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Plant fachlich korrekt und durchdacht. Die Stunden haben einen klaren Aufbau, Lernziele und Methoden sind gut aufeinander abgestimmt. Die Lerngruppe wird ber\u00fccksichtigt.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Plant in der Regel sachlich korrekt, die Struktur ist \u00fcberwiegend nachvollziehbar. Gelegentlich fehlt die Passung zwischen Zielen und Methoden oder die Ber\u00fccksichtigung der Lerngruppe.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Planung zeigt noch deutliche L\u00fccken in der fachlichen Fundierung oder Strukturierung. Der rote Faden ist nicht immer erkennbar, die Lerngruppe wird wenig ber\u00fccksichtigt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'u2',
        text: 'Wie gestaltet die LAA Lernsituationen und f\u00f6rdert die Motivation?',
        hint: 'Erkennbar z.\u202fB. an: Methodenvielfalt, kognitive Aktivierung, motivierende Impulse, lernf\u00f6rderliches Klima, Medieneinsatz, Sch\u00fclerorientierung.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Schafft durchg\u00e4ngig motivierende und kognitiv aktivierende Lernsituationen. Setzt vielf\u00e4ltige Methoden und Medien souver\u00e4n ein. Die Sch\u00fclerinnen und Sch\u00fcler arbeiten engagiert und zielorientiert.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Gestaltet Lernsituationen abwechslungsreich und motivierend. Setzt verschiedene Methoden und Medien sinnvoll ein und st\u00e4rkt die Lern- und Leistungsbereitschaft.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Nutzt verschiedene Methoden, die \u00fcberwiegend angemessen sind. Die Motivation der Lerngruppe gelingt im Allgemeinen, es gibt aber noch Potenzial bei der kognitiven Aktivierung.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Methodenwahl ist wenig abwechslungsreich. Es gelingt noch nicht durchg\u00e4ngig, die Sch\u00fclerinnen und Sch\u00fcler zu motivieren oder kognitiv zu aktivieren.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'u3',
        text: 'Wie f\u00f6rdert die LAA selbstst\u00e4ndiges Lernen und Differenzierung?',
        hint: 'Erkennbar z.\u202fB. an: differenzierende Aufgaben, F\u00f6rdern und Fordern, Lernstrategien, kooperatives Lernen, Umgang mit Heterogenit\u00e4t.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'F\u00f6rdert in besonderem Ma\u00dfe selbstbestimmtes Lernen. Stellt konsequent differenzierende Aufgaben, vermittelt Lernstrategien und nutzt Heterogenit\u00e4t als Bereicherung.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Regt die Sch\u00fclerinnen und Sch\u00fcler \u00fcberzeugend zu selbstst\u00e4ndigem Arbeiten an. Bietet differenzierende Aufgaben und f\u00f6rdert Lernstrategien.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Bietet teilweise Differenzierung an. Der Umgang mit heterogenen Lernvoraussetzungen gelingt \u00fcberwiegend, das selbstst\u00e4ndige Lernen k\u00f6nnte st\u00e4rker gef\u00f6rdert werden.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Differenzierung findet kaum statt. Die F\u00f6rderung selbstst\u00e4ndigen Lernens ist noch eingeschr\u00e4nkt; die Heterogenit\u00e4t der Lerngruppe wird wenig ber\u00fccksichtigt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'u4',
        text: 'Wie reflektiert die LAA den eigenen Unterricht?',
        hint: 'Erkennbar z.\u202fB. an: Erkennen gelungener und verbesserungsw\u00fcrdiger Aspekte, Flexibilit\u00e4t bei Schwierigkeiten, Nutzung von Hinweisen zur Optimierung.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Reflektiert den eigenen Unterricht differenziert und selbstkritisch. Erkennt Ursachen von Schwierigkeiten, reagiert souver\u00e4n und zieht eigenst\u00e4ndig Konsequenzen.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Reflektiert den Unterricht konstruktiv. Erkennt gelungene und verbesserungsw\u00fcrdige Aspekte und setzt Hinweise zur Optimierung um.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Kann Gelungenes und Schwieriges benennen, die Analyse bleibt aber teilweise oberfl\u00e4chlich. R\u00fcckmeldungen werden im Allgemeinen aufgegriffen.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Reflexionsf\u00e4higkeit ist noch wenig ausgepr\u00e4gt. Schwierigkeiten werden nicht immer erkannt; R\u00fcckmeldungen werden nur eingeschr\u00e4nkt umgesetzt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      }
    ]
  },
  {
    id: 'E',
    title: 'HF E \u2013 Den Erziehungsauftrag in Schule und Unterricht wahrnehmen',
    shortTitle: 'HF E',
    label: 'Erziehung',
    kompetenzen: 'Kompetenzen 4\u20136: Soziale/kulturelle Lebensbedingungen, Werte und Normen, Konfliktl\u00f6sung',
    questions: [
      {
        id: 'e1',
        text: 'Wie nimmt die LAA den Erziehungsauftrag im Unterricht wahr?',
        hint: 'Erkennbar z.\u202fB. an: erziehender Unterricht, Vorbildfunktion, Wertevermittlung, Anerkennung von Diversit\u00e4t, F\u00f6rderung des Arbeits- und Sozialverhaltens.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Gestaltet den Unterricht durchg\u00e4ngig als erziehenden Unterricht auf vorbildliche Weise. Vermittelt Werte und Normen \u00fcberzeugend und lebt eine Haltung der Wertsch\u00e4tzung und Anerkennung von Diversit\u00e4t vor.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Nimmt den Erziehungsauftrag \u00fcberzeugend wahr. Wirkt als positives Vorbild, vermittelt Werte klar und f\u00f6rdert das Sozialverhalten der Sch\u00fclerinnen und Sch\u00fcler.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Nimmt den Erziehungsauftrag im Allgemeinen wahr. Die Vorbildfunktion wird weitgehend erf\u00fcllt, die Wertevermittlung k\u00f6nnte noch gezielter eingesetzt werden.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Der Erziehungsauftrag wird noch unzureichend wahrgenommen. Die bewusste Wertevermittlung und die Vorbildfunktion sind noch ausbauf\u00e4hig.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'e2',
        text: 'Wie geht die LAA mit St\u00f6rungen und Konflikten um?',
        hint: 'Erkennbar z.\u202fB. an: Classroom Management, Regeldurchsetzung, pr\u00e4ventive Ma\u00dfnahmen, wertsch\u00e4tzender Umgang, Deeskalation, Umgang mit verhaltensauff\u00e4lligen SuS.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Verf\u00fcgt \u00fcber ein hervorragendes Classroom Management. Erkennt St\u00f6rungen fr\u00fchzeitig, interveniert souver\u00e4n und setzt pr\u00e4ventive Ma\u00dfnahmen wirkungsvoll ein.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Reagiert auf St\u00f6rungen angemessen und zeitnah. Setzt Regeln konsequent durch und l\u00f6st Konflikte in der Regel wertsch\u00e4tzend und l\u00f6sungsorientiert.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Nimmt St\u00f6rungen \u00fcberwiegend wahr und reagiert darauf, die Reaktionen sind aber nicht immer konsequent oder angemessen. Das Classroom Management entwickelt sich.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Der Umgang mit St\u00f6rungen und Konflikten f\u00e4llt noch schwer. Regeln werden nicht konsequent durchgesetzt, Interventionen sind teilweise unsicher.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'e3',
        text: 'Wie ber\u00fccksichtigt die LAA soziale und kulturelle Lebensbedingungen?',
        hint: 'Erkennbar z.\u202fB. an: Wahrnehmung unterschiedlicher Lebenssituationen, Ber\u00fccksichtigung von Diversit\u00e4t, Umgang mit Benachteiligungen, Medienbildung.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Zeigt ein hervorragendes Bewusstsein f\u00fcr die unterschiedlichen sozialen, kulturellen und technologischen Lebensbedingungen und ber\u00fccksichtigt diese differenziert im Unterricht.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Nimmt die unterschiedlichen Lebensbedingungen bewusst wahr und ber\u00fccksichtigt Diversit\u00e4t \u00fcberzeugend im Unterricht.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Zeigt ein grundlegendes Bewusstsein f\u00fcr soziale und kulturelle Unterschiede, nutzt dieses aber noch nicht durchgehend f\u00fcr die Unterrichtsgestaltung.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Wahrnehmung unterschiedlicher Lebensbedingungen ist noch eingeschr\u00e4nkt. Diversit\u00e4t wird im Unterricht kaum ber\u00fccksichtigt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      }
    ]
  },
  {
    id: 'L',
    title: 'HF L \u2013 Lernen und Leisten herausfordern, dokumentieren, r\u00fcckmelden und beurteilen',
    shortTitle: 'HF L',
    label: 'Leistung',
    kompetenzen: 'Kompetenzen 7\u20138: Diagnostik, F\u00f6rderung, Leistungsbewertung',
    questions: [
      {
        id: 'l1',
        text: 'Wie diagnostiziert und f\u00f6rdert die LAA individuelle Lernprozesse?',
        hint: 'Erkennbar z.\u202fB. an: Lernstandsdiagnosen, differenzierte F\u00f6rderung, individuelle R\u00fcckmeldungen, Nutzung diagnostischer Verfahren.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Diagnostiziert Lernvoraussetzungen differenziert und setzt daraus abgeleitete F\u00f6rderma\u00dfnahmen konsequent und wirkungsvoll um. Gibt hervorragende individuelle R\u00fcckmeldungen.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Erkennt Lernst\u00e4nde und -fortschritte und leitet daraus sinnvolle F\u00f6rderma\u00dfnahmen ab. R\u00fcckmeldungen sind konstruktiv und lernf\u00f6rderlich.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Setzt diagnostische Verfahren ein, die Auswertung und daraus abgeleitete F\u00f6rderung sind aber noch ausbauf\u00e4hig. R\u00fcckmeldungen erfolgen weitgehend angemessen.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Diagnostische Verfahren werden kaum eingesetzt. Individuelle F\u00f6rderung und lernf\u00f6rderliche R\u00fcckmeldungen sind noch sehr eingeschr\u00e4nkt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'l2',
        text: 'Wie gestaltet die LAA die Leistungsbewertung?',
        hint: 'Erkennbar z.\u202fB. an: Transparenz der Bewertungsma\u00dfst\u00e4be, fach- und situationsgerechte Beurteilung, kriteriengeleitete Aufgaben, Absprache mit KuK.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Bewertet Leistungen vorbildlich transparent und kriteriengeleitet. Konzipiert Aufgaben auf sehr hohem Niveau und begr\u00fcndet Bewertungen differenziert. Nutzt Leistungs\u00fcberpr\u00fcfungen als Reflexion der eigenen T\u00e4tigkeit.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Macht Bewertungsma\u00dfst\u00e4be transparent und bewertet nachvollziehbar. Konzipiert angemessene Aufgaben und verst\u00e4ndigt sich mit Kolleg*innen \u00fcber Beurteilungsgrunds\u00e4tze.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Bewertet \u00fcberwiegend nachvollziehbar, die Transparenz gegen\u00fcber den SuS und die Kriterienorientierung k\u00f6nnten aber noch verbessert werden.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Leistungsbewertung ist noch wenig transparent oder kriteriengeleitet. Absprachen mit Kolleg*innen finden kaum statt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'l3',
        text: 'Wie dokumentiert die LAA Lernfortschritte und gestaltet R\u00fcckmeldungen?',
        hint: 'Erkennbar z.\u202fB. an: systematische Dokumentation, konstruktive R\u00fcckmeldungen, Aufzeigen von Perspektiven f\u00fcr weiteres Lernen.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Dokumentiert Lernfortschritte vorbildlich systematisch und gibt exzellente, individuelle R\u00fcckmeldungen, die als Hilfe f\u00fcr weiteres Lernen dienen.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Dokumentiert Lernfortschritte zuverl\u00e4ssig und gibt konstruktive R\u00fcckmeldungen mit Perspektiven f\u00fcr das weitere Lernen.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Dokumentiert Leistungen \u00fcberwiegend angemessen. R\u00fcckmeldungen sind nachvollziehbar, k\u00f6nnten aber individueller und lernf\u00f6rderlicher gestaltet werden.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Dokumentation von Lernfortschritten ist l\u00fcckenhaft. R\u00fcckmeldungen erfolgen selten oder wenig konstruktiv.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      }
    ]
  },
  {
    id: 'B',
    title: 'HF B \u2013 Sch\u00fclerinnen und Sch\u00fcler und Erziehungsberechtigte beraten',
    shortTitle: 'HF B',
    label: 'Beratung',
    kompetenzen: 'Kompetenz 7: Beratungsanl\u00e4sse erkennen, Lernberatung, Elternberatung, Feedbackprozesse',
    questions: [
      {
        id: 'b1',
        text: 'Wie erkennt und nutzt die LAA Beratungsanl\u00e4sse?',
        hint: 'Erkennbar z.\u202fB. an: Wahrnehmen von Beratungsbedarf, Signalisieren von Gespr\u00e4chsbereitschaft, Teilnahme an Beratungstagen, Nutzung schulischer Beratungskonzepte.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Erkennt Beratungsanl\u00e4sse in besonderem Ma\u00dfe zuverl\u00e4ssig und fr\u00fchzeitig. Signalisiert stets Bereitschaft und nutzt schulische Beratungskonzepte vorbildlich.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Erkennt Beratungsanl\u00e4sse zuverl\u00e4ssig, signalisiert Gespr\u00e4chsbereitschaft und nimmt aktiv an Beratungstagen teil.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Erkennt die meisten Beratungsanl\u00e4sse, reagiert aber nicht immer zeitnah. Die Nutzung schulischer Beratungskonzepte ist noch ausbauf\u00e4hig.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Beratungsanl\u00e4sse werden noch zu selten erkannt. Die Bereitschaft zur Beratung wird nur eingeschr\u00e4nkt signalisiert.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'b2',
        text: 'Wie gestaltet die LAA Beratungsgespr\u00e4che mit SuS und Erziehungsberechtigten?',
        hint: 'Erkennbar z.\u202fB. an: Adressatengerechtigkeit, L\u00f6sungsorientierung, Einbeziehung der Beteiligten, R\u00fcckmeldung zu St\u00e4rken und Schw\u00e4chen.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'F\u00fchrt Beratungsgespr\u00e4che in besonderem Ma\u00dfe adressaten- und situationsgerecht. Sucht gemeinsam mit allen Beteiligten L\u00f6sungen und gibt differenzierte R\u00fcckmeldung.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Geht in Beratungsgespr\u00e4chen adressatengerecht und l\u00f6sungsorientiert vor. Bezieht die Beteiligten konstruktiv ein und gibt hilfreiche R\u00fcckmeldungen.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Bem\u00fcht sich um adressatengerechte Beratung. Die L\u00f6sungsorientierung und Einbeziehung aller Beteiligten gelingt \u00fcberwiegend.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Beratungsgespr\u00e4che verlaufen noch wenig adressatengerecht oder l\u00f6sungsorientiert. Die Einbeziehung der Beteiligten ist noch eingeschr\u00e4nkt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 'b3',
        text: 'Wie gestaltet die LAA Feedbackprozesse und Lernberatung?',
        hint: 'Erkennbar z.\u202fB. an: prozessbegleitendes Feedback zu St\u00e4rken und Schw\u00e4chen, Lernberatung, Kooperation mit Kolleg*innen bei Beratung.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Gibt herausragendes, prozessbegleitendes Feedback mit individueller Lernberatung. Kooperiert vorbildlich mit Kolleg*innen und nutzt Beratungsstrukturen optimal.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Gibt regelm\u00e4\u00dfig konstruktives Feedback und berät SuS individuell zu ihren St\u00e4rken und Entwicklungsfeldern. Kooperiert \u00fcberzeugend mit Kolleg*innen.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Gibt Feedback, das \u00fcberwiegend hilfreich ist. Die individuelle Lernberatung und die Kooperation bei Beratungsprozessen sind noch ausbauf\u00e4hig.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Feedbackprozesse finden kaum systematisch statt. Individuelle Lernberatung ist noch sehr eingeschr\u00e4nkt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      }
    ]
  },
  {
    id: 'S',
    title: 'HF S \u2013 Im System Schule mit allen Beteiligten entwicklungsorientiert zusammenarbeiten',
    shortTitle: 'HF S',
    label: 'System',
    kompetenzen: 'Kompetenzen 9\u201311: Berufsbewusstsein, Kompetenzentwicklung, Schul-/Unterrichtsentwicklung',
    questions: [
      {
        id: 's1',
        text: 'Wie zeigt die LAA Berufsbewusstsein und kollegiale Zusammenarbeit?',
        hint: 'Erkennbar z.\u202fB. an: Engagement \u00fcber den Unterricht hinaus, Absprachen mit KuK, Beteiligung an Konferenzen/Gremien, au\u00dferunterrichtliche Aktivit\u00e4ten.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Zeigt in besonderem Ma\u00dfe hohes Berufsbewusstsein. Arbeitet hervorragend kollegial zusammen, beteiligt sich vorbildlich an au\u00dferunterrichtlichen Aktivit\u00e4ten und wirkt in Gremien aktiv mit.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Zeigt klares Berufsbewusstsein und arbeitet konstruktiv im Team. Beteiligt sich engagiert an au\u00dferunterrichtlichen Aktivit\u00e4ten und trifft zuverl\u00e4ssig Absprachen.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Zeigt ein grundlegendes Berufsbewusstsein. Die kollegiale Zusammenarbeit gelingt \u00fcberwiegend, Eigeninitiative bei au\u00dferunterrichtlichen Aktivit\u00e4ten k\u00f6nnte st\u00e4rker sein.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Das Berufsbewusstsein ist noch wenig ausgepr\u00e4gt. Die kollegiale Zusammenarbeit findet nur eingeschr\u00e4nkt statt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 's2',
        text: 'Wie versteht die LAA den Beruf als Lernaufgabe?',
        hint: 'Erkennbar z.\u202fB. an: Reflexion der eigenen Entwicklung, Nutzung von R\u00fcckmeldungen, Einbeziehung der Ausbildungslehrkraft, Hospitationen, Fortbildungsbereitschaft.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Reflektiert die eigene Kompetenzentwicklung hervorragend differenziert. Nutzt R\u00fcckmeldungen und Hospitationen in besonderem Ma\u00dfe produktiv f\u00fcr die eigene Weiterentwicklung.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Reflektiert die eigene Entwicklung konstruktiv, nimmt R\u00fcckmeldungen \u00fcberzeugend auf und nutzt Hospitationen zur Optimierung des eigenen Handelns.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Reflektiert die eigene Entwicklung \u00fcberwiegend nachvollziehbar. R\u00fcckmeldungen werden im Allgemeinen aufgegriffen, die Umsetzung gelingt aber nicht immer konsequent.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Reflexion der eigenen Entwicklung ist noch wenig ausgepr\u00e4gt. R\u00fcckmeldungen werden nur eingeschr\u00e4nkt aufgegriffen und umgesetzt.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      },
      {
        id: 's3',
        text: 'Wie beteiligt sich die LAA an Schul- und Unterrichtsentwicklung?',
        hint: 'Erkennbar z.\u202fB. an: Mitwirkung an Projekten, Erproben neuer Konzepte, Kooperation mit externen Partnern, Umgang mit Belastungen, Zeitmanagement.',
        options: [
          { value: 4, label: 'Sehr \u00fcberzeugend', desc: 'Beteiligt sich in besonderem Ma\u00dfe aktiv und eigeninitiativ an der Schul- und Unterrichtsentwicklung. Erprobt neue Konzepte souver\u00e4n und geht mit Belastungen vorbildlich um.' },
          { value: 3, label: '\u00dcberzeugend', desc: 'Beteiligt sich aktiv an Entwicklungsprozessen, erprobt Neues in kollegialer Zusammenarbeit und geht \u00fcberzeugend mit Belastungen um.' },
          { value: 2, label: 'Solide mit Entwicklungspotenzial', desc: 'Beteiligt sich an schulischen Entwicklungsprozessen, wenn diese angeboten werden. Die Eigeninitiative und das Zeitmanagement k\u00f6nnten noch ausgebaut werden.' },
          { value: 1, label: 'Noch deutlich entwicklungsbed\u00fcrftig', desc: 'Die Beteiligung an Schul- und Unterrichtsentwicklung ist noch sehr gering. Der Umgang mit Belastungen und das Zeitmanagement sind verbesserungsw\u00fcrdig.' },
          { value: 0, label: 'Kann ich nicht beurteilen', desc: '' }
        ]
      }
    ]
  }
];

// ============================================================
// STATE
// ============================================================
let currentStep = 0;
const totalSteps = 7; // 0-6
const answers = {};

// ============================================================
// HELPERS
// ============================================================
function getMeta() {
  return {
    geschlecht: document.getElementById('metaGeschlecht').value,
    nachname: document.getElementById('metaNachname').value.trim(),
    vorname: document.getElementById('metaVorname').value.trim(),
    lehramt: document.getElementById('metaLehramt').value,
    fach: document.getElementById('metaFach').value.trim(),
    schule: document.getElementById('metaSchule').value.trim(),
    von: document.getElementById('metaVon').value,
    bis: document.getElementById('metaBis').value,
    abschnitt: document.getElementById('metaAbschnitt').value,
    beurteiler: document.getElementById('metaBeurteiler').value.trim()
  };
}

function getAnrede(meta) {
  if (meta.geschlecht === 'w') return 'Frau ' + meta.nachname;
  if (meta.geschlecht === 'm') return 'Herr ' + meta.nachname;
  return meta.nachname;
}

function getArtikel(meta) {
  if (meta.geschlecht === 'w') return { nom: 'die', dat: 'der', akk: 'die', poss: 'ihre', possD: 'ihrer' };
  if (meta.geschlecht === 'm') return { nom: 'der', dat: 'dem', akk: 'den', poss: 'seine', possD: 'seiner' };
  return { nom: 'die/der', dat: 'der/dem', akk: 'die/den', poss: 'ihre/seine', possD: 'ihrer/seiner' };
}

function getLerngruppen() {
  const rows = document.querySelectorAll('#lgTable tbody tr');
  const result = [];
  rows.forEach(r => {
    const z = r.querySelector('.lg-zeitraum').value.trim();
    const k = r.querySelector('.lg-klasse').value.trim();
    const t = r.querySelector('.lg-thema').value.trim();
    if (z || k || t) result.push({ zeitraum: z, klasse: k, thema: t });
  });
  return result;
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

function addLerngruppe() {
  const tbody = document.querySelector('#lgTable tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" class="lg-zeitraum" placeholder="z.B. 11/24 – 04/25"></td>
    <td><input type="text" class="lg-klasse" placeholder="z.B. 7b"></td>
    <td><input type="text" class="lg-thema" placeholder="z.B. Lyrik der Romantik"></td>
    <td><button class="btn btn-danger btn-sm" onclick="this.closest('tr').remove()">×</button></td>`;
  tbody.appendChild(tr);
}

// ============================================================
// PROGRESS BAR
// ============================================================
function renderProgressBar() {
  const steps = [
    { label: 'Metadaten' },
    { label: 'HF U' },
    { label: 'HF E' },
    { label: 'HF L' },
    { label: 'HF B' },
    { label: 'HF S' },
    { label: 'Ergebnis' }
  ];
  const bar = document.getElementById('progressBar');
  bar.innerHTML = '';
  steps.forEach((s, i) => {
    if (i > 0) {
      const line = document.createElement('div');
      line.className = 'progress-line' + (i <= currentStep ? ' completed' : '');
      bar.appendChild(line);
    }
    const step = document.createElement('div');
    step.className = 'progress-step' + (i === currentStep ? ' active' : '') + (i < currentStep ? ' completed' : '');
    step.innerHTML = `<div class="step-circle">${i < currentStep ? '✓' : i}</div><span class="step-label">${s.label}</span>`;
    step.onclick = () => { if (i <= currentStep || i < currentStep) goToStep(i); };
    bar.appendChild(step);
  });
}

// ============================================================
// RENDER HANDLUNGSFELD STEP
// ============================================================
function renderHFStep(hfIndex) {
  const hf = HF_DATA[hfIndex];
  const stepNum = hfIndex + 1;
  const section = document.getElementById('step' + stepNum);

  let html = `
    <h2 class="step-title">${hf.title}</h2>
    <p class="step-subtitle">${hf.kompetenzen}</p>`;

  hf.questions.forEach((q, qi) => {
    html += `
    <div class="card">
      <h3 class="card-title">${q.text}</h3>
      <p class="card-hint">${q.hint}</p>
      <div class="rating-options" id="opts_${q.id}">`;
    q.options.forEach((o, oi) => {
      const checked = answers[q.id] === o.value ? ' checked' : '';
      const selected = answers[q.id] === o.value ? ' selected' : '';
      html += `
        <label class="rating-option${selected}" onclick="selectOption(this, '${q.id}', ${o.value})">
          <input type="radio" name="${q.id}" value="${o.value}"${checked}>
          <div class="option-text">
            <span class="option-label">${o.label}</span>
            ${o.desc ? '<span class="option-desc">' + o.desc + '</span>' : ''}
          </div>
        </label>`;
    });
    html += `</div></div>`;
  });

  html += `
    <div class="card">
      <h3 class="card-title">Erg\u00e4nzende Beobachtungen (optional)</h3>
      <p class="card-hint">Gibt es konkrete Beobachtungen oder Beispiele, die du erg\u00e4nzen m\u00f6chtest?</p>
      <textarea id="freetext_${hf.id}" placeholder="z.B. konkrete Unterrichtssituationen, besondere St\u00e4rken oder Entwicklungsfelder...">${answers['freetext_' + hf.id] || ''}</textarea>
    </div>

    <div class="card">
      <h3 class="card-title">Gesamteinsch\u00e4tzung: ${hf.label}</h3>
      <p class="card-hint">Wie w\u00fcrdest du die Kompetenzentwicklung in diesem Handlungsfeld insgesamt einsch\u00e4tzen?</p>
      <div class="overall-rating" id="overall_${hf.id}">
        ${['Sehr \u00fcberzeugend', '\u00dcberzeugend', 'Solide mit Entwicklungspotenzial', 'Noch deutlich entwicklungsbed\u00fcrftig'].map((lbl, i) => {
          const val = 4 - i;
          const checked = answers['overall_' + hf.id] === val ? ' checked' : '';
          const selected = answers['overall_' + hf.id] === val ? ' selected' : '';
          return `<label class="overall-option${selected}" onclick="selectOverall(this, 'overall_${hf.id}', ${val})">
            <input type="radio" name="overall_${hf.id}" value="${val}"${checked}> ${lbl}
          </label>`;
        }).join('')}
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goToStep(${stepNum - 1})">&larr; Zur\u00fcck</button>
      <button class="btn btn-primary" onclick="goToStep(${stepNum + 1})">${stepNum < 5 ? 'Weiter →' : 'Texte generieren →'}</button>
    </div>`;

  section.innerHTML = html;
}

function selectOption(el, qid, val) {
  const parent = el.closest('.rating-options');
  parent.querySelectorAll('.rating-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  answers[qid] = val;
}

function selectOverall(el, key, val) {
  const parent = el.closest('.overall-rating');
  parent.querySelectorAll('.overall-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  answers[key] = val;
}

// ============================================================
// NAVIGATION
// ============================================================
function goToStep(step) {
  // Save freetexts from current HF step
  if (currentStep >= 1 && currentStep <= 5) {
    const hf = HF_DATA[currentStep - 1];
    const ta = document.getElementById('freetext_' + hf.id);
    if (ta) answers['freetext_' + hf.id] = ta.value;
  }

  // Validate step 0
  if (currentStep === 0 && step > 0) {
    const meta = getMeta();
    if (!meta.geschlecht || !meta.nachname || !meta.lehramt || !meta.fach || !meta.schule || !meta.von || !meta.bis || !meta.abschnitt || !meta.beurteiler) {
      showToast('Bitte alle Pflichtfelder (*) ausf\u00fcllen.');
      return;
    }
  }

  currentStep = step;

  // Render HF steps
  if (step >= 1 && step <= 5) {
    renderHFStep(step - 1);
  }

  // Generate results on step 6
  if (step === 6) {
    generateResults();
  }

  // Show/hide sections
  for (let i = 0; i < totalSteps; i++) {
    const sec = document.getElementById('step' + i);
    sec.classList.toggle('active', i === step);
  }

  renderProgressBar();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ============================================================
// TEXT GENERATION
// ============================================================
function generateResults() {
  const meta = getMeta();
  const anrede = getAnrede(meta);
  const art = getArtikel(meta);
  const abschnitt = parseInt(meta.abschnitt);
  const container = document.getElementById('resultContainer');

  let allTexts = [];

  // Lerngruppen header
  const lg = getLerngruppen();
  let lgInfo = '';
  if (lg.length > 0) {
    lgInfo = lg.map(l => `${l.klasse} (${l.zeitraum}): ${l.thema}`).join('; ');
  }

  HF_DATA.forEach((hf, hfi) => {
    const overall = answers['overall_' + hf.id] || 0;
    const freetext = (answers['freetext_' + hf.id] || '').trim();
    const text = generateHFText(hf, meta, anrede, art, abschnitt, overall, freetext);
    allTexts.push({ title: hf.title, text });
  });

  let html = '';
  allTexts.forEach(t => {
    html += `
      <div class="result-block">
        <div class="result-header">
          <span>${t.title}</span>
          <button class="copy-btn" onclick="copyBlock(this, ${JSON.stringify(t.text).replace(/"/g, '&quot;')})">Kopieren</button>
        </div>
        <div class="result-body">${t.text}</div>
      </div>`;
  });

  container.innerHTML = html;
}

function generateHFText(hf, meta, anrede, art, abschnitt, overall, freetext) {
  const sentences = [];

  hf.questions.forEach(q => {
    const val = answers[q.id];
    if (val === undefined || val === 0) return;
    sentences.push(generateSentence(q.id, val, anrede, art, abschnitt, hf.id));
  });

  if (freetext) {
    sentences.push(freetext);
  }

  // Add overall summary sentence
  if (overall > 0) {
    sentences.push(generateOverallSentence(hf.id, overall, anrede, art, abschnitt));
  }

  return sentences.join(' ');
}

function generateSentence(qid, val, anrede, art, abschnitt, hfId) {
  const isEarly = abschnitt === 1;

  // Text templates per question and rating level
  const templates = {
    // HF U
    u1: {
      4: `${anrede} plant ${art.poss}n Unterricht in besonderem Ma\u00dfe sachlich und fachlich fundiert. Die Stunden sind hervorragend strukturiert \u2013 Ziele, Inhalte und Methoden greifen nahtlos ineinander. Die Planung ber\u00fccksichtigt differenziert die Lernvoraussetzungen der jeweiligen Lerngruppe.`,
      3: `${anrede} plant den Unterricht fachlich korrekt und durchdacht. Die Stunden weisen einen klaren Aufbau auf, Lernziele und Methoden sind gut aufeinander abgestimmt und die Lerngruppe wird angemessen ber\u00fccksichtigt.`,
      2: `${anrede} plant den Unterricht in der Regel sachlich korrekt. Die Strukturierung der Stunden ist \u00fcberwiegend nachvollziehbar${isEarly ? ', wobei die Passung zwischen Zielen und Methoden im Laufe der Ausbildung zunehmend besser gelingt' : ', gelegentlich fehlt jedoch noch die Passung zwischen Zielen und Methoden'}.`,
      1: `${anrede} zeigt${isEarly ? ' im bisherigen Verlauf der Ausbildung' : ''} noch deutliche Entwicklungsbedarfe bei der Unterrichtsplanung. Der rote Faden ist nicht immer erkennbar und die Lernvoraussetzungen der Lerngruppe werden noch nicht ausreichend ber\u00fccksichtigt.`
    },
    u2: {
      4: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA schafft durchg\u00e4ngig motivierende und kognitiv aktivierende Lernsituationen. Vielf\u00e4ltige Methoden und Medien werden souver\u00e4n eingesetzt, sodass die Sch\u00fclerinnen und Sch\u00fcler engagiert und zielorientiert arbeiten.`,
      3: `Die Gestaltung von Lernsituationen gelingt ${anrede} \u00fcberzeugend. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA setzt verschiedene Methoden und Medien sinnvoll ein und st\u00e4rkt die Lern- und Leistungsbereitschaft der Sch\u00fclerinnen und Sch\u00fcler.`,
      2: `${anrede} nutzt verschiedene Methoden, die \u00fcberwiegend angemessen sind. Die Motivation der Lerngruppe gelingt im Allgemeinen${isEarly ? ' und zeigt eine positive Entwicklung' : ', bei der kognitiven Aktivierung besteht jedoch noch Entwicklungspotenzial'}.`,
      1: `Die Methodenwahl ist${isEarly ? ' bislang' : ''} wenig abwechslungsreich. Es gelingt ${anrede} noch nicht durchg\u00e4ngig, die Sch\u00fclerinnen und Sch\u00fcler zu motivieren oder kognitiv zu aktivieren.`
    },
    u3: {
      4: `${anrede} f\u00f6rdert in besonderem Ma\u00dfe das selbstbestimmte Lernen der Sch\u00fclerinnen und Sch\u00fcler. Differenzierende Aufgaben werden konsequent eingesetzt, Lernstrategien gezielt vermittelt und Heterogenit\u00e4t als Bereicherung genutzt.`,
      3: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA regt die Sch\u00fclerinnen und Sch\u00fcler \u00fcberzeugend zu selbstst\u00e4ndigem Arbeiten an, bietet differenzierende Aufgaben und f\u00f6rdert Lern- und Arbeitsstrategien.`,
      2: `${anrede} bietet teilweise Differenzierung an. Der Umgang mit heterogenen Lernvoraussetzungen gelingt \u00fcberwiegend${isEarly ? ', wobei sich hier im Laufe der Ausbildung eine zunehmende Sicherheit zeigt' : ', das selbstst\u00e4ndige Lernen k\u00f6nnte jedoch st\u00e4rker gef\u00f6rdert werden'}.`,
      1: `Differenzierung findet${isEarly ? ' bislang' : ''} kaum statt. Die F\u00f6rderung selbstst\u00e4ndigen Lernens ist noch eingeschr\u00e4nkt und die Heterogenit\u00e4t der Lerngruppe wird wenig ber\u00fccksichtigt.`
    },
    u4: {
      4: `Die Reflexion des eigenen Unterrichts gelingt ${anrede} in besonderem Ma\u00dfe differenziert und selbstkritisch. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA erkennt Ursachen von Schwierigkeiten, reagiert souver\u00e4n und zieht eigenst\u00e4ndig Konsequenzen f\u00fcr die Weiterarbeit.`,
      3: `${anrede} reflektiert den eigenen Unterricht konstruktiv, erkennt gelungene und verbesserungsw\u00fcrdige Aspekte und setzt Hinweise zur Optimierung \u00fcberzeugend um.`,
      2: `${anrede} kann gelungene und schwierige Aspekte benennen, die Analyse bleibt aber teilweise noch oberfl\u00e4chlich. R\u00fcckmeldungen werden im Allgemeinen aufgegriffen${isEarly ? ' \u2013 eine positive Entwicklung ist erkennbar' : ''}.`,
      1: `Die Reflexionsf\u00e4higkeit ist${isEarly ? ' bislang' : ''} noch wenig ausgepr\u00e4gt. Schwierigkeiten im Unterricht werden nicht immer erkannt und R\u00fcckmeldungen nur eingeschr\u00e4nkt umgesetzt.`
    },
    // HF E
    e1: {
      4: `${anrede} nimmt den Erziehungsauftrag in besonderem Ma\u00dfe \u00fcberzeugend wahr und gestaltet den Unterricht durchg\u00e4ngig als erziehenden Unterricht. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA wirkt vorbildlich und vermittelt Werte und eine Haltung der Wertsch\u00e4tzung und Anerkennung von Diversit\u00e4t.`,
      3: `${anrede} nimmt den Erziehungsauftrag \u00fcberzeugend wahr. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA wirkt als positives Vorbild, vermittelt Werte und Normen klar und f\u00f6rdert das Sozialverhalten der Sch\u00fclerinnen und Sch\u00fcler.`,
      2: `${anrede} nimmt den Erziehungsauftrag im Allgemeinen wahr. Die Vorbildfunktion wird weitgehend erf\u00fcllt${isEarly ? ', wobei die bewusste Wertevermittlung im Laufe der Ausbildung zunehmend gelingt' : ', die gezielte Wertevermittlung k\u00f6nnte jedoch noch verst\u00e4rkt werden'}.`,
      1: `Der Erziehungsauftrag wird${isEarly ? ' bislang' : ''} noch unzureichend wahrgenommen. Die bewusste Wertevermittlung und die Vorbildfunktion sind noch deutlich ausbauf\u00e4hig.`
    },
    e2: {
      4: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA verf\u00fcgt \u00fcber ein hervorragendes Classroom Management. St\u00f6rungen werden fr\u00fchzeitig erkannt, ${anrede} interveniert souver\u00e4n und setzt pr\u00e4ventive Ma\u00dfnahmen wirkungsvoll ein.`,
      3: `${anrede} reagiert auf St\u00f6rungen angemessen und zeitnah. Regeln werden konsequent durchgesetzt und Konflikte in der Regel wertsch\u00e4tzend und l\u00f6sungsorientiert gel\u00f6st.`,
      2: `${anrede} nimmt St\u00f6rungen \u00fcberwiegend wahr und reagiert darauf${isEarly ? ', wobei sich die Konsequenz und Angemessenheit der Reaktionen zunehmend verbessern' : ', die Reaktionen sind jedoch nicht immer konsequent'}. Das Classroom Management entwickelt sich.`,
      1: `Der Umgang mit St\u00f6rungen und Konflikten f\u00e4llt ${anrede}${isEarly ? ' zum jetzigen Zeitpunkt der Ausbildung' : ''} noch schwer. Regeln werden nicht konsequent durchgesetzt und Interventionen sind teilweise unsicher.`
    },
    e3: {
      4: `${anrede} zeigt ein hervorragendes Bewusstsein f\u00fcr die unterschiedlichen sozialen, kulturellen und technologischen Lebensbedingungen der Sch\u00fclerinnen und Sch\u00fcler und ber\u00fccksichtigt diese differenziert im Unterricht.`,
      3: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA nimmt die unterschiedlichen Lebensbedingungen der Sch\u00fclerinnen und Sch\u00fcler bewusst wahr und ber\u00fccksichtigt Diversit\u00e4t \u00fcberzeugend im Unterricht.`,
      2: `${anrede} zeigt ein grundlegendes Bewusstsein f\u00fcr soziale und kulturelle Unterschiede${isEarly ? ', das sich im Laufe der Ausbildung weiterentwickelt' : ', nutzt dieses aber noch nicht durchgehend f\u00fcr die Unterrichtsgestaltung'}.`,
      1: `Die Wahrnehmung unterschiedlicher Lebensbedingungen ist${isEarly ? ' bislang' : ''} noch eingeschr\u00e4nkt. Diversit\u00e4t wird im Unterricht kaum ber\u00fccksichtigt.`
    },
    // HF L
    l1: {
      4: `${anrede} diagnostiziert Lernvoraussetzungen differenziert und setzt daraus abgeleitete F\u00f6rderma\u00dfnahmen konsequent und wirkungsvoll um. Die individuellen R\u00fcckmeldungen sind von hervorragender Qualit\u00e4t.`,
      3: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA erkennt Lernst\u00e4nde und Lernfortschritte zuverl\u00e4ssig und leitet daraus sinnvolle F\u00f6rderma\u00dfnahmen ab. Die R\u00fcckmeldungen an die Sch\u00fclerinnen und Sch\u00fcler sind konstruktiv und lernf\u00f6rderlich.`,
      2: `${anrede} setzt diagnostische Verfahren ein${isEarly ? ' und zeigt hier eine zunehmende Sicherheit' : ', die Auswertung und daraus abgeleitete F\u00f6rderung sind jedoch noch ausbauf\u00e4hig'}. R\u00fcckmeldungen erfolgen weitgehend angemessen.`,
      1: `Diagnostische Verfahren werden${isEarly ? ' bislang' : ''} kaum eingesetzt. Individuelle F\u00f6rderung und lernf\u00f6rderliche R\u00fcckmeldungen sind noch sehr eingeschr\u00e4nkt.`
    },
    l2: {
      4: `${anrede} bewertet Leistungen vorbildlich transparent und kriteriengeleitet. Aufgabenstellungen werden auf sehr hohem Niveau konzipiert und Bewertungen differenziert begr\u00fcndet. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA nutzt Leistungs\u00fcberpr\u00fcfungen in besonderem Ma\u00dfe als konstruktive Reflexion der eigenen Unterrichtst\u00e4tigkeit.`,
      3: `Die Bewertungsma\u00dfst\u00e4be werden transparent gemacht und Leistungen nachvollziehbar bewertet. ${anrede} konzipiert angemessene Aufgaben und verst\u00e4ndigt sich mit Kolleginnen und Kollegen \u00fcber Beurteilungsgrunds\u00e4tze.`,
      2: `${anrede} bewertet \u00fcberwiegend nachvollziehbar${isEarly ? ', wobei die Transparenz und Kriterienorientierung mit wachsender Erfahrung zunehmen' : ', die Transparenz gegen\u00fcber den Sch\u00fclerinnen und Sch\u00fclern sowie die Kriterienorientierung k\u00f6nnten jedoch noch verbessert werden'}.`,
      1: `Die Leistungsbewertung ist${isEarly ? ' bislang' : ''} noch wenig transparent oder kriteriengeleitet. Absprachen mit Kolleginnen und Kollegen finden kaum statt.`
    },
    l3: {
      4: `Lernfortschritte werden vorbildlich systematisch dokumentiert. ${anrede} gibt exzellente individuelle R\u00fcckmeldungen, die den Sch\u00fclerinnen und Sch\u00fclern als echte Hilfe f\u00fcr ihr weiteres Lernen dienen.`,
      3: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA dokumentiert Lernfortschritte zuverl\u00e4ssig und gibt konstruktive R\u00fcckmeldungen mit Perspektiven f\u00fcr das weitere Lernen.`,
      2: `${anrede} dokumentiert Leistungen \u00fcberwiegend angemessen. Die R\u00fcckmeldungen sind nachvollziehbar${isEarly ? ' und werden im Laufe der Ausbildung zunehmend individueller' : ', k\u00f6nnten aber individueller und lernf\u00f6rderlicher gestaltet werden'}.`,
      1: `Die Dokumentation von Lernfortschritten ist${isEarly ? ' bislang' : ''} l\u00fcckenhaft. R\u00fcckmeldungen erfolgen selten oder wenig konstruktiv.`
    },
    // HF B
    b1: {
      4: `${anrede} erkennt Beratungsanl\u00e4sse in besonderem Ma\u00dfe zuverl\u00e4ssig und fr\u00fchzeitig. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA signalisiert stets Gespr\u00e4chsbereitschaft und nutzt schulische Beratungskonzepte vorbildlich.`,
      3: `${anrede} erkennt Beratungsanl\u00e4sse zuverl\u00e4ssig, signalisiert Gespr\u00e4chsbereitschaft und nimmt aktiv an Beratungstagen teil.`,
      2: `${anrede} erkennt die meisten Beratungsanl\u00e4sse${isEarly ? ' zunehmend sicherer' : ', reagiert aber nicht immer zeitnah'}. Die Nutzung schulischer Beratungskonzepte ist noch ausbauf\u00e4hig.`,
      1: `Beratungsanl\u00e4sse werden${isEarly ? ' bislang' : ''} noch zu selten erkannt. Die Bereitschaft zur Beratung wird nur eingeschr\u00e4nkt signalisiert.`
    },
    b2: {
      4: `Beratungsgespr\u00e4che f\u00fchrt ${anrede} in besonderem Ma\u00dfe adressaten- und situationsgerecht. Gemeinsam mit allen Beteiligten werden L\u00f6sungen gesucht und differenzierte R\u00fcckmeldungen gegeben.`,
      3: `In Beratungsgespr\u00e4chen geht ${anrede} adressatengerecht und l\u00f6sungsorientiert vor, bezieht die Beteiligten konstruktiv ein und gibt hilfreiche R\u00fcckmeldungen.`,
      2: `${anrede} bem\u00fcht sich um adressatengerechte Beratung. Die L\u00f6sungsorientierung und Einbeziehung aller Beteiligten gelingt \u00fcberwiegend${isEarly ? ' und entwickelt sich positiv' : ''}.`,
      1: `Beratungsgespr\u00e4che verlaufen${isEarly ? ' bislang' : ''} noch wenig adressatengerecht oder l\u00f6sungsorientiert.`
    },
    b3: {
      4: `${anrede} gibt herausragendes, prozessbegleitendes Feedback mit individueller Lernberatung und kooperiert vorbildlich mit Kolleginnen und Kollegen in Beratungsprozessen.`,
      3: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA gibt regelm\u00e4\u00dfig konstruktives Feedback und ber\u00e4t Sch\u00fclerinnen und Sch\u00fcler individuell zu ihren St\u00e4rken und Entwicklungsfeldern. Die Kooperation mit Kolleginnen und Kollegen gelingt \u00fcberzeugend.`,
      2: `${anrede} gibt Feedback, das \u00fcberwiegend hilfreich ist${isEarly ? ' und sich im Laufe der Ausbildung zunehmend differenziert' : '. Die individuelle Lernberatung und die Kooperation bei Beratungsprozessen sind noch ausbauf\u00e4hig'}.`,
      1: `Feedbackprozesse finden${isEarly ? ' bislang' : ''} kaum systematisch statt. Individuelle Lernberatung ist noch sehr eingeschr\u00e4nkt.`
    },
    // HF S
    s1: {
      4: `${anrede} zeigt in besonderem Ma\u00dfe hohes Berufsbewusstsein und verf\u00fcgt \u00fcber hervorragende kollegiale Zusammenarbeit. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA beteiligt sich vorbildlich an au\u00dferunterrichtlichen Aktivit\u00e4ten und wirkt in Gremien aktiv mit.`,
      3: `${anrede} zeigt klares Berufsbewusstsein und arbeitet konstruktiv im Team. ${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA beteiligt sich engagiert an au\u00dferunterrichtlichen Aktivit\u00e4ten und trifft zuverl\u00e4ssig Absprachen mit Kolleginnen und Kollegen.`,
      2: `${anrede} zeigt ein grundlegendes Berufsbewusstsein. Die kollegiale Zusammenarbeit gelingt \u00fcberwiegend${isEarly ? ', wobei die Eigeninitiative mit der zunehmenden Vertrautheit im System w\u00e4chst' : ', die Eigeninitiative bei au\u00dferunterrichtlichen Aktivit\u00e4ten k\u00f6nnte st\u00e4rker sein'}.`,
      1: `Das Berufsbewusstsein ist${isEarly ? ' bislang' : ''} noch wenig ausgepr\u00e4gt. Die kollegiale Zusammenarbeit findet nur eingeschr\u00e4nkt statt.`
    },
    s2: {
      4: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA reflektiert die eigene Kompetenzentwicklung hervorragend differenziert und nutzt R\u00fcckmeldungen sowie Hospitationen in besonderem Ma\u00dfe produktiv f\u00fcr die eigene Weiterentwicklung.`,
      3: `${anrede} reflektiert die eigene Entwicklung konstruktiv, nimmt R\u00fcckmeldungen \u00fcberzeugend auf und nutzt Hospitationen zur Optimierung des eigenen Handelns.`,
      2: `${anrede} reflektiert die eigene Entwicklung \u00fcberwiegend nachvollziehbar. R\u00fcckmeldungen werden im Allgemeinen aufgegriffen${isEarly ? ', die Umsetzung wird mit fortschreitender Ausbildung zunehmend konsequenter' : ', die Umsetzung gelingt aber nicht immer konsequent'}.`,
      1: `Die Reflexion der eigenen Entwicklung ist${isEarly ? ' bislang' : ''} noch wenig ausgepr\u00e4gt. R\u00fcckmeldungen werden nur eingeschr\u00e4nkt aufgegriffen und umgesetzt.`
    },
    s3: {
      4: `${anrede} beteiligt sich in besonderem Ma\u00dfe aktiv und eigeninitiativ an der Schul- und Unterrichtsentwicklung, erprobt neue Konzepte souver\u00e4n und geht mit Belastungen vorbildlich um. Arbeitszeit und Arbeitsmittel werden stets zweckdienlich und \u00f6konomisch eingesetzt.`,
      3: `${art.nom.charAt(0).toUpperCase() + art.nom.slice(1)} LAA beteiligt sich aktiv an schulischen Entwicklungsprozessen, erprobt Neues in kollegialer Zusammenarbeit und geht \u00fcberzeugend mit Belastungen um.`,
      2: `${anrede} beteiligt sich an schulischen Entwicklungsprozessen, wenn diese angeboten werden${isEarly ? '. Die Eigeninitiative w\u00e4chst mit zunehmender Vertrautheit im System' : '. Die Eigeninitiative und das Zeitmanagement k\u00f6nnten noch ausgebaut werden'}.`,
      1: `Die Beteiligung an Schul- und Unterrichtsentwicklung ist${isEarly ? ' zum jetzigen Zeitpunkt' : ''} noch sehr gering. Der Umgang mit Belastungen und das Zeitmanagement sind verbesserungsw\u00fcrdig.`
    }
  };

  return (templates[qid] && templates[qid][val]) || '';
}

function generateOverallSentence(hfId, overall, anrede, art, abschnitt) {
  const isEarly = abschnitt === 1;
  const hfNames = { U: 'Unterricht', E: 'Erziehung', L: 'Leistungsbewertung', B: 'Beratung', S: 'Zusammenarbeit im System Schule' };
  const hfName = hfNames[hfId] || '';

  switch (overall) {
    case 4: return `Insgesamt zeigt ${anrede} im Bereich ${hfName} eine in besonderem Ma\u00dfe \u00fcberzeugende Kompetenzentwicklung.`;
    case 3: return `Insgesamt zeigt ${anrede} im Bereich ${hfName} eine \u00fcberzeugende Kompetenzentwicklung.`;
    case 2: return `Insgesamt zeigt ${anrede} im Bereich ${hfName} eine solide Kompetenzentwicklung${isEarly ? ', die weiteres Entwicklungspotenzial erkennen l\u00e4sst' : ' mit erkennbarem Entwicklungspotenzial'}.`;
    case 1: return `Insgesamt ist die Kompetenzentwicklung von ${anrede} im Bereich ${hfName}${isEarly ? ' zum jetzigen Zeitpunkt der Ausbildung' : ''} noch deutlich entwicklungsbed\u00fcrftig.`;
    default: return '';
  }
}

// ============================================================
// EXPORT FUNCTIONS
// ============================================================
function copyBlock(btn, text) {
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'Kopiert!';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'Kopieren'; btn.classList.remove('copied'); }, 2000);
  });
}

function copyAll() {
  const blocks = document.querySelectorAll('.result-body');
  const texts = [];
  document.querySelectorAll('.result-block').forEach(block => {
    const title = block.querySelector('.result-header span').textContent;
    const body = block.querySelector('.result-body').textContent;
    texts.push(title + '\n' + body);
  });
  navigator.clipboard.writeText(texts.join('\n\n')).then(() => showToast('Alle Texte in die Zwischenablage kopiert!'));
}

function toInitials(name) {
  if (!name) return '';
  return name.trim().split(/\s+/).map(w => w.charAt(0).toUpperCase() + '.').join('');
}

function copyKIPrompt(anonymized) {
  const meta = getMeta();
  const lg = getLerngruppen();

  let laaName, anredePrompt, beurteilerName, schuleName;

  if (anonymized) {
    const initialen = toInitials((meta.vorname ? meta.vorname + ' ' : '') + meta.nachname);
    laaName = initialen;
    anredePrompt = meta.geschlecht === 'w' ? 'Frau ' + initialen : meta.geschlecht === 'm' ? 'Herr ' + initialen : initialen;
    beurteilerName = toInitials(meta.beurteiler);
    schuleName = '[Schule]';
  } else {
    const anrede = getAnrede(meta);
    laaName = (meta.vorname ? meta.vorname + ' ' : '') + meta.nachname;
    anredePrompt = anrede;
    beurteilerName = meta.beurteiler;
    schuleName = meta.schule;
  }

  let prompt = `Du bist ein Experte f\u00fcr die Erstellung von Beurteilungsbeitr\u00e4gen gem\u00e4\u00df \u00a7 16 (2) OVP NRW. Erstelle einen professionellen, kompetenzorientierten Beurteilungsbeitrag als Flie\u00dftext f\u00fcr die folgenden f\u00fcnf Handlungsfelder.\n\n`;
  prompt += `== METADATEN ==\n`;
  prompt += `LAA: ${anredePrompt} (${laaName})\n`;
  prompt += `Geschlecht: ${meta.geschlecht === 'w' ? 'weiblich' : meta.geschlecht === 'm' ? 'm\u00e4nnlich' : 'divers'}\n`;
  prompt += `Lehramt: ${meta.lehramt}\n`;
  prompt += `Fach/F\u00e4cher: ${meta.fach}\n`;
  prompt += `Ausbildungsschule: ${schuleName}\n`;
  prompt += `Beurteilungszeitraum: ${meta.von} bis ${meta.bis}\n`;
  prompt += `Ausbildungsabschnitt: ${meta.abschnitt === '1' ? 'Erster' : meta.abschnitt === '2' ? 'Zweiter' : 'Weiterer'}\n`;
  prompt += `Beurteiler*in: ${beurteilerName}\n`;

  if (lg.length > 0) {
    prompt += `\nLerngruppen:\n`;
    lg.forEach(l => prompt += `- ${l.klasse} (${l.zeitraum}): ${l.thema}\n`);
  }

  HF_DATA.forEach(hf => {
    prompt += `\n== ${hf.title} ==\n`;
    hf.questions.forEach(q => {
      const val = answers[q.id];
      if (val === undefined || val === 0) {
        prompt += `- ${q.text}: Nicht beobachtet\n`;
      } else {
        const opt = q.options.find(o => o.value === val);
        prompt += `- ${q.text}: ${opt.label}${opt.desc ? ' (' + opt.desc + ')' : ''}\n`;
      }
    });
    const ft = (answers['freetext_' + hf.id] || '').trim();
    if (ft) prompt += `Erg\u00e4nzende Beobachtungen: ${ft}\n`;
    const ov = answers['overall_' + hf.id];
    if (ov) {
      const labels = { 4: 'Sehr \u00fcberzeugend', 3: '\u00dcberzeugend', 2: 'Solide mit Entwicklungspotenzial', 1: 'Noch deutlich entwicklungsbed\u00fcrftig' };
      prompt += `Gesamteinsch\u00e4tzung: ${labels[ov]}\n`;
    }
  });

  prompt += `\n== ANWEISUNGEN ==\n`;
  prompt += `1. Formuliere f\u00fcr jedes Handlungsfeld einen eigenst\u00e4ndigen, fl\u00fcssig lesbaren Flie\u00dftext (ca. 5\u201310 S\u00e4tze).\n`;
  prompt += `2. Verwende die korrekte Anrede: "${anredePrompt}".\n`;
  prompt += `3. ${meta.abschnitt === '1' ? 'Da es sich um den ersten Ausbildungsabschnitt handelt, verwende Formulierungen wie "zunehmend", "mit Unterst\u00fctzung", "erste Schritte", die dem Ausbildungsstand angemessen sind.' : 'Formuliere dem fortgeschrittenen Ausbildungsstand angemessen.'}\n`;
  prompt += `4. Benenne sowohl St\u00e4rken als auch Entwicklungsfelder \u2013 immer wertsch\u00e4tzend und entwicklungsorientiert.\n`;
  prompt += `5. Es wird KEINE Note erteilt \u2013 verwende aber Formulierungsvokabular, das ein klares Leistungsbild vermittelt.\n`;
  prompt += `6. Orientiere dich am Bewertungsvokabular: Sehr gut: hervorragend, souver\u00e4n, vorbildlich, \u00fcberzeugend | Gut: \u00fcberzeugend, fundiert, durchdacht, sicher | Befriedigend: solide, weitgehend, \u00fcberwiegend, im Allgemeinen | Ausreichend: eingeschr\u00e4nkt, teilweise, noch, verbesserungsw\u00fcrdig\n`;
  prompt += `7. Integriere die erg\u00e4nzenden Beobachtungen als konkrete Beispiele in den Text.\n`;
  prompt += `8. Der Text muss direkt in das offizielle Formular (Anlage B1.1 zur OVP) \u00fcbernommen werden k\u00f6nnen.\n`;

  const label = anonymized ? 'Anonymisierter KI-Prompt' : 'KI-Prompt';
  navigator.clipboard.writeText(prompt).then(() => showToast(label + ' in die Zwischenablage kopiert!'));
}

// ============================================================
// INIT
// ============================================================
renderProgressBar();
</script>
</body>
</html>
